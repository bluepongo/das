basePath: /api/v1
info:
  contact:
    email: romber2001@gmail.com
    name: Romber Li
    url: http://www.github.com/romberli/das
  description: das is shortcut for Database Autonomy Service, it provides self-perception,
    repair, optimization, and security database service.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  title: DAS
  version: "1.0"
paths:
  /api/v1/alert/email:
    post:
      consumes:
      - application/json
      parameters:
      - description: optional config
        in: body
        name: config
        schema:
          type: string
      - description: to addrs
        in: body
        name: toAddrs
        required: true
        schema:
          type: string
      - description: cc addrs
        in: body
        name: ccAddrs
        required: true
        schema:
          type: string
      - description: to content
        in: body
        name: content
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"message": "sending email completed successfully"}'
          schema:
            type: string
      summary: send email
      tags:
      - alert
  /api/v1/healthcheck/check:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: body
        name: server_id
        required: true
        schema:
          type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: step
        in: body
        name: step
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"operation_id: 16", "message": "healthcheck started"}'
          schema:
            type: string
      summary: check health of the database
      tags:
      - healthcheck
  /api/v1/healthcheck/check/host-info:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: mysql port number
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: step
        in: body
        name: step
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"operation_id: 18", "message": "healthcheck by host info
            started"}'
          schema:
            type: string
      summary: check health of the database by host ip and port number
      tags:
      - healthcheck
  /api/v1/healthcheck/history:
    get:
      consumes:
      - application/json
      parameters:
      - description: login name
        in: path
        name: login_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"operation_histories":[{"id":30,"mysql_server_id":1,"host_ip":"192.168.137.11","port_num":3306,"start_time":"2022-03-11T19:46:16+08:00","end_time":"2022-03-18T19:46:16+08:00","step":60,"status":2,"message":"healthcheck
            completed successfully. engine: default, operation_id: 30","del_flag":0,"create_time":"2022-03-18T19:46:16.215941+08:00","last_update_time":"2022-03-18T19:46:17.450918+08:00"}]}'
          schema:
            type: string
      summary: get result by operation id
      tags:
      - healthcheck
  /api/v1/healthcheck/result/:operation_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: operation id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"result":{"id":7,"operation_id":16,"host_ip":"192.168.137.11","port_num":3306,"weighted_average_score":99,"db_config_score":90,"db_config_data":"[{"variable_name":"binlog_format","variable_value":"ROW"},{"variable_name":"binlog_row_image","variable_value":"FULL"},{"variable_name":"enforce_gtid_consistency","variable_value":"ON"},{"variable_name":"gtid_mode","variable_value":"ON"},{"variable_name":"innodb_flush_log_at_trx_commit","variable_value":"2"},{"variable_name":"innodb_flush_method","variable_value":"O_DIRECT"},{"variable_name":"innodb_print_all_deadlocks","variable_value":"ON"},{"variable_name":"log_bin","variable_value":"ON"},{"variable_name":"master_info_repository","variable_value":"TABLE"},{"variable_name":"performance_schema","variable_value":"ON"},{"variable_name":"relay_log_info_repository","variable_value":"TABLE"},{"variable_name":"report_host","variable_value":"192.168.137.11"},{"variable_name":"report_port","variable_value":"3306"},{"variable_name":"slave_parallel_type","variable_value":"DATABASE"},{"variable_name":"slow_query_log","variable_value":"ON"},{"variable_name":"sync_binlog","variable_value":"0"}]","db_config_advice":[{"name":"innodb_flush_log_at_trx_commit","value":"2","advice":"1"},{"name":"slave_parallel_type","value":"DATABASE","advice":"LOGICAL_CLOCK"},{"name":"sync_binlog","value":"0","advice":"1"}],"avg_backup_failed_ratio_score":100,"avg_backup_failed_ratio_data":"null","avg_backup_failed_ratio_high":"null","statistics_failed_ratio_score":100,"statistics_failed_ratio_data":"null","statistics_failed_ratio_high":"null","cpu_usage_score":100,"cpu_usage_data":"null","cpu_usage_high":"null","io_util_score":100,"io_util_data":"null","io_util_high":"null","disk_capacity_usage_score":100,"disk_capacity_usage_data":"null","disk_capacity_usage_high":"null","connection_usage_score":100,"connection_usage_data":"null","connection_usage_high":"null","average_active_session_percents_score":100,"average_active_session_percents_data":"null","average_active_session_percents_high":"null","cache_miss_ratio_score":100,"cache_miss_ratio_data":"null","cache_miss_ratio_high":"null","table_rows_score":100,"table_rows_data":"[]","table_rows_high":"null","table_size_score":100,"table_size_data":"[]","table_size_high":"null","slow_query_score":100,"slow_query_data":"[]","slow_query_advice":"","accuracy_review":0,"del_flag":0,"create_time":"2022-03-04
            16:32:40.331139 +0800 CST","last_update_time":"2022-03-04 16:32:40.331139
            +0800 CST"}'
          schema:
            type: string
      summary: get result by operation id
      tags:
      - healthcheck
  /api/v1/healthcheck/review:
    post:
      consumes:
      - application/json
      parameters:
      - description: operation id
        in: body
        name: operation_id
        required: true
        schema:
          type: integer
      - description: review
        in: body
        name: review
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"operation_id: 1", "message": "reviewed accuracy completed"}'
          schema:
            type: string
      summary: update accuracy review
      tags:
      - healthcheck
  /api/v1/metadata/app:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: get all applications
      tags:
      - application
    post:
      consumes:
      - application/json
      parameters:
      - description: app name
        in: body
        name: app_name
        required: true
        schema:
          type: string
      - description: app level
        in: body
        name: level
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: add a new application
      tags:
      - application
  /api/v1/metadata/app/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: get application by id
      tags:
      - application
    post:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      - description: app name
        in: body
        name: app_name
        schema:
          type: string
      - description: app level
        in: body
        name: level
        schema:
          type: integer
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: update application by id
      tags:
      - application
  /api/v1/metadata/app/add-db/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      - description: db id
        in: body
        name: db_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1,"db_name": "db2","cluster_id": 3,"cluster_type":
            1,"env_id": 1,"del_flag": 0,"create_time": "2022-01-04T15:08:33.418288+08:00","last_update_time":
            "2022-01-25T16:17:26.284761+08:00"},}]}'
          schema:
            type: string
      summary: add database map
      tags:
      - application
  /api/v1/metadata/app/add-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: add user map
      tags:
      - application
  /api/v1/metadata/app/app-name/:name:
    get:
      consumes:
      - application/json
      parameters:
      - description: app name
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: get application by system name
      tags:
      - application
  /api/v1/metadata/app/delete-db/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      - description: db id
        in: body
        name: db_id
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1,"db_name": "db2","cluster_id": 3,"cluster_type":
            1,"env_id": 1,"del_flag": 0,"create_time": "2022-01-04T15:08:33.418288+08:00","last_update_time":
            "2022-01-25T16:17:26.284761+08:00"},}]}'
          schema:
            type: string
      summary: delete database map
      tags:
      - application
  /api/v1/metadata/app/delete-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: delete user map
      tags:
      - application
  /api/v1/metadata/app/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"id":65,"cluster_name":"new_middleware_cluster","env_id":1,"del_flag":0,"create_time":"2022-03-02T10:39:06.206145+08:00","last_update_time":"2022-03-02T10:39:06.206145+08:00"}]}
          schema:
            type: string
      summary: delete middleware cluster by id
      tags:
      - middleware cluster
  /api/v1/metadata/db:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get all databases
      tags:
      - database
    post:
      consumes:
      - application/json
      parameters:
      - description: db name
        in: body
        name: db_name
        required: true
        schema:
          type: string
      - description: cluster id
        in: body
        name: cluster_id
        required: true
        schema:
          type: integer
      - description: cluster type
        in: body
        name: cluster_type
        schema:
          type: integer
      - description: env id
        in: body
        name: env_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: add a new database
      tags:
      - database
  /api/v1/metadata/db/add-app/:id:
    post:
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      - description: app id
        in: body
        name: app_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [{"create_time":"2021-11-10T18:39:12.395612+08:00","last_update_time":"2021-12-21T09:15:47.688546+08:00","id":1,"app_name":"app1","level":1,"del_flag":0},{"last_update_time":"2021-12-21T09:15:47.688546+08:00","id":3,"app_name":"app3","level":3,"del_flag":0,"create_time":"2021-11-02T18:02:34.153234+08:00"}]}'
          schema:
            type: string
      summary: add application map
      tags:
      - database
  /api/v1/metadata/db/add-user/:id:
    post:
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"employee_id":"","telephone":"","create_time":"2022-03-01T17:53:21.046511+08:00","last_update_time":"2022-03-01T17:53:21.046511+08:00","mobile":"","role":3,"id":2,"user_name":"test","department_name":"","account_name":"aaaa","email":"qqqq","del_flag":0},{"role":3,"create_time":"2022-01-25T12:21:05.19953+08:00","user_name":"test1","employee_id":"","account_name":"aaa","email":"aaa","telephone":"","mobile":"","last_update_time":"2022-01-25T12:21:05.19953+08:00","id":3,"department_name":"","del_flag":0}]}'
          schema:
            type: string
      summary: add user map
      tags:
      - database
  /api/v1/metadata/db/all-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"department_name": "dn","account_name": "da",
            "mobile": "m", "del_flag": 0,"last_update_time": "2021-01-21T13:00:00+08:00","user_name":
            "un","create_time": "2021-01-21T13:00:00+08:00","employee_id": 1,"email":
            "e","telephone": "t","role": 1, "id": 1}]}'
          schema:
            type: string
      summary: get all users
      tags:
      - database
  /api/v1/metadata/db/app-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"department_name": "dn","account_name": "da",
            "mobile": "m", "del_flag": 0,"last_update_time": "2021-01-21T13:00:00+08:00","user_name":
            "un","create_time": "2021-01-21T13:00:00+08:00","employee_id": 1,"email":
            "e","telephone": "t","role": 1, "id": 1}]}'
          schema:
            type: string
      summary: get app users
      tags:
      - database
  /api/v1/metadata/db/app/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [{"id": 66, "system_name": "kkk", "del_flag": 0,
            "create_time": "2021-01-21T10:00:00+08:00", "last_update_time": "2021-01-21T10:00:00+08:00",
            "level": 8, "owner_group": "k"}]}'
          schema:
            type: string
      summary: get apps by id
      tags:
      - database
  /api/v1/metadata/db/db-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"department_name": "dn","account_name": "da",
            "mobile": "m", "del_flag": 0,"last_update_time": "2021-01-21T13:00:00+08:00","user_name":
            "un","create_time": "2021-01-21T13:00:00+08:00","employee_id": 1,"email":
            "e","telephone": "t","role": 1, "id": 1}]}'
          schema:
            type: string
      summary: get db users
      tags:
      - database
  /api/v1/metadata/db/delete-app/:id:
    post:
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      - description: app id
        in: body
        name: app_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [{"last_update_time":"2021-12-21T09:15:47.688546+08:00","id":1,"app_name":"app1","level":1,"del_flag":0,"create_time":"2021-11-10T18:39:12.395612+08:00"}]}'
          schema:
            type: string
      summary: delete application map
      tags:
      - database
  /api/v1/metadata/db/delete-user/:id:
    post:
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id":2,"employee_id":"","role":3,"del_flag":0,"create_time":"2022-03-01T17:53:21.046511+08:00","last_update_time":"2022-03-01T17:53:21.046511+08:00","user_name":"test","department_name":"","account_name":"aaaa","email":"qqqq","telephone":"","mobile":""}]}'
          schema:
            type: string
      summary: delete user map
      tags:
      - database
  /api/v1/metadata/db/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: delete database by id
      tags:
      - database
  /api/v1/metadata/db/env/:env_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: env_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get database by env_id
      tags:
      - database
  /api/v1/metadata/db/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get database by id
      tags:
      - database
  /api/v1/metadata/db/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: host_ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port_num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "pmm_test", "cluster_id": 1,
            "cluster_type": 1, "env_id": 1, "del_flag": 0, "create_time": "2022-03-14T09:59:21.379851+08:00",
            "last_update_time": "2022-03-14T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get databases by host info
      tags:
      - database
  /api/v1/metadata/db/mysql-cluster/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_cluster": [{"middleware_cluster_id":1,"monitor_system_id":1,"env_id":1,"del_flag":0,"create_time":"2021-02-23T20:57:24.603009+08:00","last_update_time":"2021-02-23T20:57:24.603009+08:00","id":1,"cluster_name":"cluster_name_init"},{"monitor_system_id":1,
            "env_id":1,"create_time":"2021-02-23T04:14:23.707238+08:00","last_update_time":"2021-02-23T04:14:23.707238+08:00","id":2,"cluster_name":"newTest","middleware_cluster_id":1,"del_flag":0}]}'
          schema:
            type: string
      summary: get mysql cluster by id
      tags:
      - database
  /api/v1/metadata/db/name-and-cluster-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: db name
        in: body
        name: db_name
        required: true
        schema:
          type: string
      - description: cluster id
        in: body
        name: cluster_id
        required: true
        schema:
          type: integer
      - description: cluster type
        in: body
        name: cluster_type
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get database by db name and cluster info
      tags:
      - database
  /api/v1/metadata/db/name-and-host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: db name
        in: body
        name: db_name
        required: true
        schema:
          type: string
      - description: host_ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port_num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "pmm_test", "cluster_id": 1,
            "cluster_type": 1, "env_id": 1, "del_flag": 0, "create_time": "2022-03-14T09:59:21.379851+08:00",
            "last_update_time": "2022-03-14T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get database by db name and host info
      tags:
      - database
  /api/v1/metadata/db/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: id
        required: true
        type: integer
      - description: db name
        in: body
        name: db_name
        schema:
          type: string
      - description: cluster id
        in: body
        name: cluster_id
        schema:
          type: integer
      - description: cluster type
        in: body
        name: cluster_type
        schema:
          type: integer
      - description: env id
        in: body
        name: env_id
        schema:
          type: integer
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1, "db_name": "db1", "cluster_id": 1, "cluster_type":
            1, "env_id": 1, "del_flag": 0, "create_time": "2021-01-22T09:59:21.379851+08:00",
            "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: update database by id
      tags:
      - database
  /api/v1/metadata/env:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get all environments
      tags:
      - environment
    post:
      consumes:
      - application/json
      parameters:
      - description: env name
        in: body
        name: env_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: add a new environment
      tags:
      - environment
  /api/v1/metadata/env/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get environment by id
      tags:
      - environment
  /api/v1/metadata/env/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: delete environment by id
      tags:
      - environment
  /api/v1/metadata/env/env-name/:env_name:
    get:
      consumes:
      - application/json
      parameters:
      - description: env name
        in: path
        name: env_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get environment by Name
      tags:
      - environment
  /api/v1/metadata/env/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: id
        required: true
        type: integer
      - description: env name
        in: body
        name: env_name
        schema:
          type: string
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"envs": [{"id": 1, "env_name": "online", "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: update environment by id
      tags:
      - environment
  /api/v1/metadata/middleware-cluster:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"id":1,"cluster_name":"middleware-cluster-1","env_id":1,"del_flag":0,"create_time":"2021-11-09T18:06:57.917596+08:00","last_update_time":"2021-11-18T15:39:52.927116+08:00"}]}
          schema:
            type: string
      summary: get all middleware clusters
      tags:
      - middleware cluster
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster name
        in: body
        name: cluster_name
        required: true
        schema:
          type: string
      - description: env id
        in: body
        name: env_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"id":65,"cluster_name":"new_middleware_cluster","env_id":1,"del_flag":0,"create_time":"2022-03-02T10:39:06.206145+08:00","last_update_time":"2022-03-02T10:39:06.206145+08:00"}]}
          schema:
            type: string
      summary: add a new middleware cluster
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/add-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: users":[{"account_name":"zs001","email":"allinemailtest@163.com","mobile":"13012345678","del_flag":0,"create_time":"2021-10-25T09:21:50.364327+08:00","user_name":"zhangsan","department_name":"arch","employee_id":"100001","telephone":"01012345678","role":3,"last_update_time":"2021-11-22T13:46:20.430926+08:00","id":1}]}
          schema:
            type: string
      summary: add user map
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/cluster-name/:cluster_name:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster name
        in: path
        name: cluster_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"cluster_name":"middleware-cluster-1","env_id":1,"del_flag":0,"create_time":"2021-11-09T18:06:57.917596+08:00","last_update_time":"2021-11-18T15:39:52.927116+08:00","id":1}]}
          schema:
            type: string
      summary: get middleware cluster by name
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/delete-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: users":[]}
          schema:
            type: string
      summary: delete user map
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/env/:env_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: env_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"del_flag":0,"create_time":"2021-11-09T18:06:57.917596+08:00","last_update_time":"2021-11-18T15:39:52.927116+08:00","id":1,"cluster_name":"middleware-cluster-1","env_id":1}]}
          schema:
            type: string
      summary: get middleware cluster by env_id
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"del_flag":0,"create_time":"2021-11-09T18:06:57.917596+08:00","last_update_time":"2021-11-18T15:39:52.927116+08:00","id":1,"cluster_name":"middleware-cluster-1","env_id":1}]}
          schema:
            type: string
      summary: get middleware cluster by id
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-cluster/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: middleware cluster name
        in: body
        name: cluster_name
        schema:
          type: string
      - description: env id
        in: body
        name: env_id
        schema:
          type: integer
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_clusters":[{"last_update_time":"2021-11-18T15:39:52.927116+08:00","id":1,"cluster_name":"update_middleware_cluster","env_id":1,"del_flag":0,"create_time":"2021-11-09T18:06:57.917596+08:00"}]}
          schema:
            type: string
      summary: update middleware cluster by id
      tags:
      - middleware cluster
  /api/v1/metadata/middleware-server:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"last_update_time":"2021-11-18T15:54:10.599097+08:00","cluster_id":1,"server_name":"middleware-server-1","port_num":33061,"del_flag":0,"create_time":"2021-11-17T14:47:10.521279+08:00","id":1,"middleware_role":1,"host_ip":"192.168.10.219"}]}
          schema:
            type: string
      summary: get all middleware servers
      tags:
      - middleware server
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: body
        name: cluster_id
        required: true
        schema:
          type: integer
      - description: middleware server name
        in: body
        name: server_name
        required: true
        schema:
          type: string
      - description: middleware role
        in: body
        name: middleware_role
        required: true
        schema:
          type: integer
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port number
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"host_ip":"192.168.10.219","del_flag":0,"create_time":"2022-03-02T10:18:28.021994+08:00","last_update_time":"2022-03-02T10:18:28.021994+08:00","cluster_id":1,"server_name":"new_middleware_server","middleware_role":1,"id":42,"port_num":33062}]}
          schema:
            type: string
      summary: add a new middleware server
      tags:
      - middleware server
  /api/v1/metadata/middleware-server/cluster-id/:cluster_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: cluster_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"id":1,"cluster_id":1,"server_name":"middleware-server-1","host_ip":"192.168.10.219","port_num":33061,"del_flag":0,"create_time":"2021-11-17T14:47:10.521279+08:00","last_update_time":"2021-11-18T15:54:10.599097+08:00","middleware_role":1}]}
          schema:
            type: string
      summary: get middleware servers by cluster id
      tags:
      - middleware server
  /api/v1/metadata/middleware-server/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware server id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"server_name":"new_middleware_server","host_ip":"192.168.10.219","port_num":33062,"create_time":"2022-03-02T10:18:28.021994+08:00","last_update_time":"2022-03-02T10:18:28.021994+08:00","id":42,"cluster_id":1,"middleware_role":1,"del_flag":0}]}
          schema:
            type: string
      summary: delete middleware server by id
      tags:
      - middleware server
  /api/v1/metadata/middleware-server/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware server id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"last_update_time":"2021-11-18T15:54:10.599097+08:00","id":1,"server_name":"middleware-server-1","middleware_role":1,"port_num":33061,"cluster_id":1,"host_ip":"192.168.10.219","del_flag":0,"create_time":"2021-11-17T14:47:10.521279+08:00"}]}
          schema:
            type: string
      summary: get middleware server by id
      tags:
      - middleware server
  /api/v1/metadata/middleware-server/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port number
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"middleware_role":1,"host_ip":"192.168.10.219","del_flag":0,"last_update_time":"2021-11-18T15:54:10.599097+08:00","id":1,"server_name":"middleware-server-1","cluster_id":1,"port_num":33061,"create_time":"2021-11-17T14:47:10.521279+08:00"}]}
          schema:
            type: string
      summary: get middleware server by host info
      tags:
      - middleware server
  /api/v1/metadata/middleware-server/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: body
        name: cluster_id
        required: true
        schema:
          type: integer
      - description: middleware server name
        in: body
        name: server_name
        schema:
          type: string
      - description: middleware role
        in: body
        name: middleware_role
        schema:
          type: integer
      - description: host ip
        in: body
        name: host_ip
        schema:
          type: string
      - description: port number
        in: body
        name: port_num
        schema:
          type: integer
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"del_flag":0,"server_name":"update_middeware_server","host_ip":"192.168.10.219","port_num":33061,"middleware_role":1,"create_time":"2021-11-17T14:47:10.521279+08:00","last_update_time":"2021-11-18T15:54:10.599097+08:00","id":1,"cluster_id":1}]}
          schema:
            type: string
      summary: update middleware server by id
      tags:
      - middleware server
  /api/v1/metadata/monitor-system:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"id": 1, "system_name": "pmm", "system_type":
            1, "host_ip": "127.0.0.1", "port_num": 3306, "port_num_slow": 3307, "base_url":
            "http://127.0.0.1/prometheus/api/v1/", "env_id": 1, "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get all monitor systems
      tags:
      - monitor system
    post:
      consumes:
      - application/json
      parameters:
      - description: system name
        in: body
        name: system_name
        required: true
        schema:
          type: string
      - description: system type
        in: body
        name: system_type
        required: true
        schema:
          type: integer
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: port num slow
        in: body
        name: port_num_slow
        required: true
        schema:
          type: integer
      - description: base url
        in: body
        name: base_url
        required: true
        schema:
          type: string
      - description: env id
        in: body
        name: env_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"id":40,"system_name":"new_monitor_system","system_type":2,"host_ip":"192.168.10.219","port_num":8080,"port_num_slow":9000,"create_time":"2022-03-02T12:06:38.622752+08:00","env_id":1,"del_flag":0,"last_update_time":"2022-03-02T12:06:38.622752+08:00","base_url":"/prometheus"}]}'
          schema:
            type: string
      summary: add a new monitor system
      tags:
      - monitor system
  /api/v1/metadata/monitor-system/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: monitor system id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"id":40,"system_type":2,"port_num_slow":9000,"env_id":1,"create_time":"2022-03-02T12:06:38.622752+08:00","system_name":"new_monitor_system","host_ip":"192.168.10.219","port_num":8080,"base_url":"/prometheus","del_flag":0,"last_update_time":"2022-03-02T12:06:38.622752+08:00"}]}'
          schema:
            type: string
      summary: delete monitor system by id
      tags:
      - monitor system
  /api/v1/metadata/monitor-system/env/:env_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: env id
        in: path
        name: env_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"id": 1, "system_name": "pmm", "system_type":
            1, "host_ip": "127.0.0.1", "port_num": 3306, "port_num_slow": 3307, "base_url":
            "http://127.0.0.1/prometheus/api/v1/", "env_id": 1, "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get monitor system by env_id
      tags:
      - monitor system
  /api/v1/metadata/monitor-system/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: monitor system id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"id": 1, "system_name": "pmm", "system_type":
            1, "host_ip": "127.0.0.1", "port_num": 3306, "port_num_slow": 3307, "base_url":
            "http://127.0.0.1/prometheus/api/v1/", "env_id": 1, "del_flag": 0, "create_time":
            "2021-01-22T09:59:21.379851+08:00", "last_update_time": "2021-01-22T09:59:21.379851+08:00"}]}'
          schema:
            type: string
      summary: get monitor system by id
      tags:
      - monitor system
  /api/v1/metadata/monitor-system/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"port_num_slow":9000,"base_url":"/prometheus","create_time":"2021-09-02T09:06:30.736111+08:00","last_update_time":"2021-11-18T16:16:18.702104+08:00","host_ip":"192.168.10.219","port_num":80,"env_id":1,"del_flag":0,"id":1,"system_name":"pmm2","system_type":2},{"base_url":"/prometheus","env_id":1,"del_flag":0,"create_time":"2021-09-02T15:11:19.558733+08:00","id":2,"port_num":80,"port_num_slow":33061,"last_update_time":"2021-11-10T10:01:52.717786+08:00","system_name":"pmm1","system_type":1,"host_ip":"192.168.10.220"}]}'
          schema:
            type: string
      summary: get monitor system by host info
      tags:
      - monitor system
  /api/v1/metadata/monitor-system/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: monitor system id
        in: path
        name: id
        required: true
        type: integer
      - description: system name
        in: body
        name: system_name
        schema:
          type: string
      - description: system type
        in: body
        name: system_type
        schema:
          type: integer
      - description: host ip
        in: body
        name: host_ip
        schema:
          type: string
      - description: port num
        in: body
        name: port_num
        schema:
          type: integer
      - description: port num slow
        in: body
        name: port_num_slow
        schema:
          type: integer
      - description: base url
        in: body
        name: base_url
        schema:
          type: string
      - description: env id
        in: body
        name: env_id
        schema:
          type: integer
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"monitor_systems": [{"system_name":"update_monitor_system","host_ip":"192.168.10.219","port_num_slow":9000,"env_id":1,"id":1,"system_type":2,"port_num":3300,"base_url":"/prometheus","del_flag":0,"create_time":"2021-09-02T09:06:30.736111+08:00","last_update_time":"2021-11-18T16:16:18.702104+08:00"}]}'
          schema:
            type: string
      summary: update monitor system by id
      tags:
      - monitor system
  /api/v1/metadata/mysql-cluster:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"middleware_cluster_id":1,"monitor_system_id":1,"env_id":1,"del_flag":0,"create_time":"2021-02-23T20:57:24.603009+08:00","last_update_time":"2021-02-23T20:57:24.603009+08:00","id":1,"cluster_name":"cluster_name_init"}]}'
          schema:
            type: string
      summary: get all mysql clusters
      tags:
      - mysql cluster
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster name
        in: body
        name: cluster_name
        required: true
        schema:
          type: string
      - description: middleware cluster id
        in: body
        name: middleware_cluster_id
        schema:
          type: integer
      - description: monitor system id
        in: body
        name: monitor_system_id
        schema:
          type: integer
      - description: env id
        in: body
        name: env_id
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"id":3,"cluster_name":"api_test","monitor_system_id":0,"env_id":1,"create_time":"2022-03-01T08:30:43.428343+08:00","middleware_cluster_id":0,"del_flag":0,"last_update_time":"2022-03-01T08:30:43.428343+08:00"}]}'
          schema:
            type: string
      summary: add a new mysql cluster
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"del_flag":0,"create_time":"2021-02-23T20:57:24.603009+08:00","id":1,"monitor_system_id":1,"env_id":1,"last_update_time":"2021-02-23T20:57:24.603009+08:00","cluster_name":"cluster_name_init","middleware_cluster_id":1}]}'
          schema:
            type: string
      summary: get mysql cluster by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/add-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","email":"allinemailtest@163.com","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","account_name":"zs001","telephone":"01012345678","mobile":"13012345678","create_time":"2021-10-25T09:21:50.364327+08:00","last_update_time":"2021-11-22T13:46:20.430926+08:00"}}'
          schema:
            type: string
      summary: add user map
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/all-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","account_name":"zs001","last_update_time":"2021-11-22T13:46:20.430926+08:00","mobile":"13012345678","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","email":"allinemailtest@163.com","telephone":"01012345678","create_time":"2021-10-25T09:21:50.364327+08:00"}]}'
          schema:
            type: string
      summary: get all users
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/app-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","account_name":"zs001","last_update_time":"2021-11-22T13:46:20.430926+08:00","mobile":"13012345678","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","email":"allinemailtest@163.com","telephone":"01012345678","create_time":"2021-10-25T09:21:50.364327+08:00"}]}'
          schema:
            type: string
      summary: get app users
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/cluster-name/:name:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster name
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"del_flag":0,"create_time":"2021-02-23T20:57:24.603009+08:00","id":1,"monitor_system_id":1,"env_id":1,"last_update_time":"2021-02-23T20:57:24.603009+08:00","cluster_name":"cluster_name_init","middleware_cluster_id":1}]}'
          schema:
            type: string
      summary: get mysql cluster by name
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/db-user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","account_name":"zs001","last_update_time":"2021-11-22T13:46:20.430926+08:00","mobile":"13012345678","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","email":"allinemailtest@163.com","telephone":"01012345678","create_time":"2021-10-25T09:21:50.364327+08:00"}]}'
          schema:
            type: string
      summary: get db users
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/db/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs":[{"cluster_type":1,"del_flag":0,"last_update_time":"2021-12-29T14:11:06.500863+08:00","id":2,"db_name":"das","cluster_id":1,"env_id":1,"create_time":"2021-09-02T15:14:40.782387+08:00"}]}'
          schema:
            type: string
      summary: get dbs by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/delete-user/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: user id
        in: body
        name: user_id
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","email":"allinemailtest@163.com","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","account_name":"zs001","telephone":"01012345678","mobile":"13012345678","create_time":"2021-10-25T09:21:50.364327+08:00","last_update_time":"2021-11-22T13:46:20.430926+08:00"}]}'
          schema:
            type: string
      summary: delete user map
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/delete/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"cluster_name":"test","env_id":1,"del_flag":0,"create_time":"2022-03-01T08:30:43.428343+08:00","last_update_time":"2022-03-01T08:32:25.715563+08:00","id":3,"middleware_cluster_id":0,"monitor_system_id":0}]}'
          schema:
            type: string
      summary: update mysql cluster by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/master-server/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_server":{"id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","deployment_type":1,"last_update_time":"2021-12-21T09:16:20.184065+08:00","cluster_id":1,"host_ip":"192.168.10.219","port_num":3306,"version":"5.7","del_flag":0,"create_time":"2021-09-02T11:16:06.561525+08:00"}}'
          schema:
            type: string
      summary: get master servers by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/mysql-server/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","deployment_type":1,"last_update_time":"2021-12-21T09:16:20.184065+08:00","cluster_id":1,"host_ip":"192.168.10.219","port_num":3306,"version":"5.7","del_flag":0,"create_time":"2021-09-02T11:16:06.561525+08:00"}]}'
          schema:
            type: string
      summary: get mysql servers by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      - description: mysql cluster name
        in: body
        name: cluster_name
        schema:
          type: string
      - description: middleware cluster id
        in: body
        name: middleware_cluster_id
        schema:
          type: integer
      - description: monitor system id
        in: body
        name: monitor_system_id
        schema:
          type: integer
      - description: env id
        in: body
        name: env_id
        schema:
          type: string
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters":[{"middleware_cluster_id":0,"monitor_system_id":0,"last_update_time":"2022-03-01T08:30:43.428343+08:00","id":3,"cluster_name":"test","env_id":1,"del_flag":0,"create_time":"2022-03-01T08:30:43.428343+08:00"}]}'
          schema:
            type: string
      summary: update mysql cluster by id
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-cluster/user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users":[{"id":1,"employee_id":"100001","account_name":"zs001","last_update_time":"2021-11-22T13:46:20.430926+08:00","mobile":"13012345678","role":3,"del_flag":0,"user_name":"zhangsan","department_name":"arch","email":"allinemailtest@163.com","telephone":"01012345678","create_time":"2021-10-25T09:21:50.364327+08:00"}]}'
          schema:
            type: string
      summary: get mysql cluster users
      tags:
      - mysql cluster
  /api/v1/metadata/mysql-server:
    get:
      consumes:
      - application/json
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-01T08:19:09.779365+08:00","cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219","id":1,"deployment_type":1,"version":"5.7","del_flag":0}]}'
          schema:
            type: string
      summary: get all mysql servers
      tags:
      - mysql server
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: body
        name: cluster_id
        required: true
        schema:
          type: integer
      - description: mysql server name
        in: body
        name: server_name
        required: true
        schema:
          type: string
      - description: mysql server service name
        in: body
        name: service_name
        schema:
          type: string
      - description: mysql server host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: mysql server port num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: mysql deployment type
        in: body
        name: deployment_type
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"deployment_type":1,"version":"","id":26,"server_name":"test","service_name":"test","port_num":3306,"del_flag":0,"create_time":"2022-03-02T01:26:32.107625+08:00","last_update_time":"2022-03-02T01:26:32.107625+08:00","cluster_id":97,"host_ip":"192.168.1.1"}]}'
          schema:
            type: string
      summary: add a new mysql server
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"id":1,"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-02T01:14:14.13647+08:00","deployment_type":1,"version":"5.7","del_flag":0,"cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219"}]}'
          schema:
            type: string
      summary: get mysql servers by host info
      tags:
      - mysql server
    post:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: path
        name: id
        required: true
        type: integer
      - description: mysql cluster id
        in: body
        name: cluster_id
        schema:
          type: integer
      - description: mysql server name
        in: body
        name: server_name
        schema:
          type: string
      - description: mysql server service name
        in: body
        name: service_name
        schema:
          type: string
      - description: mysql server host ip
        in: body
        name: host_ip
        schema:
          type: string
      - description: mysql server port num
        in: body
        name: port_num
        schema:
          type: integer
      - description: mysql deployment type
        in: body
        name: deployment_type
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"deployment_type":1,"version":"","id":26,"server_name":"test","service_name":"test","port_num":3306,"del_flag":0,"create_time":"2022-03-02T01:26:32.107625+08:00","last_update_time":"2022-03-02T01:26:32.107625+08:00","cluster_id":97,"host_ip":"192.168.1.1"}]}'
          schema:
            type: string
      summary: update mysql server by id
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/cluster-id/:cluster_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: cluster_id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-01T08:19:09.779365+08:00","cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219","id":1,"deployment_type":1,"version":"5.7","del_flag":0}]}'
          schema:
            type: string
      summary: get mysql servers by cluster id
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-01T08:19:09.779365+08:00","cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219","id":1,"deployment_type":1,"version":"5.7","del_flag":0}]}'
          schema:
            type: string
      summary: get mysql server by id
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: path
        name: host_ip
        required: true
        type: string
      - description: host port number
        in: path
        name: port_num
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-01T08:19:09.779365+08:00","cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219","id":1,"deployment_type":1,"version":"5.7","del_flag":0}]}'
          schema:
            type: string
      summary: get mysql servers by host info
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/is-master/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: path
        name: host_ip
        required: true
        type: string
      - description: host port number
        in: path
        name: port_num
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"host_ip":"192.168.1.2","port_num":"3306"}'
          schema:
            type: string
      summary: check if mysql server is a master node
      tags:
      - mysql server
  /api/v1/metadata/mysql-server/mysql-cluster/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"server_name":"test","service_name":"test","host_ip":"192.168.1.1","port_num":3306,"del_flag":0,"create_time":"2022-03-02T01:26:32.107625+08:00","last_update_time":"2022-03-02T01:26:32.107625+08:00","id":26,"cluster_id":1,"deployment_type":1,"version":""}]}'
          schema:
            type: string
      summary: get mysql cluster by id
      tags:
      - mysql server
  /api/v1/metadata/table/analyze/db:
    post:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: body
        name: db_id
        required: true
        schema:
          type: integer
      - description: table name
        in: body
        name: table_name
        required: true
        schema:
          type: string
      - description: account name or employee id
        in: body
        name: login_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"message": "analyze table completed. db id: 1, table name:
            t_meta_db_info"}'
          schema:
            type: string
      summary: analyze table by db id and table name
      tags:
      - Tables
  /api/v1/metadata/table/analyze/host-info-db:
    post:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: db name
        in: body
        name: db_name
        required: true
        schema:
          type: string
      - description: table name
        in: body
        name: table_name
        required: true
        schema:
          type: string
      - description: account name or employee id
        in: body
        name: login_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"message": "analyze table completed. host ip: 192.168.137.11,
            port num: 3306, db name: das, table name: t_meta_db_info"}'
          schema:
            type: string
      summary: analyze table by host info and db name and table name
      tags:
      - Tables
  /api/v1/metadata/table/db:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: body
        name: id
        required: true
        schema:
          type: integer
      - description: account name or employee id
        in: body
        name: login_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"tables": [{"db_name": "das","table_name": "t_meta_db_info"}]}'
          schema:
            type: string
      summary: get tables by db id
      tags:
      - Tables
  /api/v1/metadata/table/statistic/db:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: body
        name: db_id
        required: true
        schema:
          type: integer
      - description: table name
        in: body
        name: table_name
        required: true
        schema:
          type: string
      - description: account name or employee id
        in: body
        name: login_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"table_statistics": [{"size_mb": 0.015, "engine": "InnoDB",
            "char_set": "utf8mb4", "collation": "utf8mb4_general_ci", "create_time":
            "2022-03-04T14:24:11+08:00", "table_name": "t_meta_db_info", "size": 16384,
            "avg_row_length": 16384, "auto_increment": 2, "db_name": "das", "table_rows":
            1}], "index_statistics": [{"is_nullable": false,"db_name": "das", "table_name":
            "t_meta_db_info", "index_name": "PRIMARY", "sequence":1, "column_name":
            "id", "cardinality": 1, "is_unique": true}, {"is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id",
            "sequence": 1, "column_name": "db_name", "cardinality": 1, "is_unique":
            true}, {"column_name": "cluster_id", "cardinality": 1, "is_unique": true,
            "is_nullable": false, "db_name": "das", "table_name": "t_meta_db_info",
            "index_name": "idx01_db_name_cluster_id_cluster_type_env_id", "sequence":
            2}, {"cardinality": 1, "is_unique": true, "is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id",
            "sequence":3 ,"column_name": "cluster_type"}, {"sequence": 4,"column_name":
            "env_id", "cardinality": 1, "is_unique":true, "is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id"}],
            "create_statement": "CREATE TABLE `t_meta_db_info` (\n  `id` int(11) NOT
            NULL AUTO_INCREMENT COMMENT ''主键ID'',\n  `db_name` varchar(100) NOT NULL
            COMMENT ''数据库名称'',\n  `cluster_id` int(11) NOT NULL COMMENT ''数据库集群ID'',\n  `cluster_type`
            tinyint(4) NOT NULL DEFAULT ''1'' COMMENT ''集群类型: 1-单库, 2-分库分表'',\n  `env_id`
            int(11) NOT NULL COMMENT ''环境: 1-online, 2-rel, 3-uat, 4-sit, 5-pt, 6-dev'',\n  `del_flag`
            tinyint(4) NOT NULL DEFAULT ''0'' COMMENT ''删除标记: 0-未删除, 1-已删除'',\n  `create_time`
            datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) COMMENT ''创建时间'',\n  `last_update_time`
            datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6)
            COMMENT ''最后更新时间'',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `idx01_db_name_cluster_id_cluster_type_env_id`
            (`db_name`,`cluster_id`,`cluster_type`,`env_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2
            DEFAULT CHARSET=utf8mb4 COMMENT=''数据库信息表''"}'
          schema:
            type: string
      summary: get table statistics by db id and table name
      tags:
      - Tables
  /api/v1/metadata/table/statistic/host-info-db:
    get:
      consumes:
      - application/json
      parameters:
      - description: host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: port num
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: db name
        in: body
        name: db_name
        required: true
        schema:
          type: string
      - description: table name
        in: body
        name: table_name
        required: true
        schema:
          type: string
      - description: account name or employee id
        in: body
        name: login_name
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"table_statistics": [{"size_mb": 0.015, "engine": "InnoDB",
            "char_set": "utf8mb4", "collation": "utf8mb4_general_ci", "create_time":
            "2022-03-04T14:24:11+08:00", "table_name": "t_meta_db_info", "size": 16384,
            "avg_row_length": 16384, "auto_increment": 2, "db_name": "das", "table_rows":
            1}], "index_statistics": [{"is_nullable": false,"db_name": "das", "table_name":
            "t_meta_db_info", "index_name": "PRIMARY", "sequence":1, "column_name":
            "id", "cardinality": 1, "is_unique": true}, {"is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id",
            "sequence": 1, "column_name": "db_name", "cardinality": 1, "is_unique":
            true}, {"column_name": "cluster_id", "cardinality": 1, "is_unique": true,
            "is_nullable": false, "db_name": "das", "table_name": "t_meta_db_info",
            "index_name": "idx01_db_name_cluster_id_cluster_type_env_id", "sequence":
            2}, {"cardinality": 1, "is_unique": true, "is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id",
            "sequence":3 ,"column_name": "cluster_type"}, {"sequence": 4,"column_name":
            "env_id", "cardinality": 1, "is_unique":true, "is_nullable": false, "db_name":
            "das", "table_name": "t_meta_db_info", "index_name": "idx01_db_name_cluster_id_cluster_type_env_id"}],
            "create_statement": "CREATE TABLE `t_meta_db_info` (\n  `id` int(11) NOT
            NULL AUTO_INCREMENT COMMENT ''主键ID'',\n  `db_name` varchar(100) NOT NULL
            COMMENT ''数据库名称'',\n  `cluster_id` int(11) NOT NULL COMMENT ''数据库集群ID'',\n  `cluster_type`
            tinyint(4) NOT NULL DEFAULT ''1'' COMMENT ''集群类型: 1-单库, 2-分库分表'',\n  `env_id`
            int(11) NOT NULL COMMENT ''环境: 1-online, 2-rel, 3-uat, 4-sit, 5-pt, 6-dev'',\n  `del_flag`
            tinyint(4) NOT NULL DEFAULT ''0'' COMMENT ''删除标记: 0-未删除, 1-已删除'',\n  `create_time`
            datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) COMMENT ''创建时间'',\n  `last_update_time`
            datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6)
            COMMENT ''最后更新时间'',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `idx01_db_name_cluster_id_cluster_type_env_id`
            (`db_name`,`cluster_id`,`cluster_type`,`env_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2
            DEFAULT CHARSET=utf8mb4 COMMENT=''数据库信息表''"}'
          schema:
            type: string
      summary: get table statistics by host info and db name and table name
      tags:
      - Tables
  /api/v1/metadata/user:
    post:
      consumes:
      - application/json
      parameters:
      - description: user name
        in: body
        name: user_name
        required: true
        schema:
          type: string
      - description: department name
        in: body
        name: department_name
        required: true
        schema:
          type: string
      - description: employee id
        in: body
        name: employee_id
        required: true
        schema:
          type: string
      - description: user telephone
        in: body
        name: telephone
        required: true
        schema:
          type: string
      - description: user role
        in: body
        name: role
        required: true
        schema:
          type: integer
      - description: account name
        in: body
        name: account_name
        required: true
        schema:
          type: string
      - description: email
        in: body
        name: email
        required: true
        schema:
          type: string
      - description: mobile
        in: body
        name: mobile
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: add a new user
      tags:
      - user
  /api/v1/metadata/user/account-name/:account_name:
    get:
      consumes:
      - application/json
      parameters:
      - description: account name
        in: path
        name: account_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by account name
      tags:
      - user
  /api/v1/metadata/user/all-mysql-server/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_servers":[{"port_num":3306,"create_time":"2021-09-02T11:16:06.561525+08:00","last_update_time":"2022-03-01T08:19:09.779365+08:00","cluster_id":1,"server_name":"192-168-10-219","service_name":"192-168-10-219:3306","host_ip":"192.168.10.219","id":1,"deployment_type":1,"version":"5.7","del_flag":0}]}'
          schema:
            type: string
      summary: get all mysql servers by id
      tags:
      - user
  /api/v1/metadata/user/app/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"apps": [ {"id": 2,"app_name": "app2","level": 2,"del_flag":
            0,"create_time": "2021-10-25T09:46:04.275796+08:00","last_update_time":
            "2021-12-21T09:15:47.688546+08:00"}]}'
          schema:
            type: string
      summary: get apps by id
      tags:
      - user
  /api/v1/metadata/user/db/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1,"db_name": "db2","cluster_id": 3,"cluster_type":
            1,"env_id": 1,"del_flag": 0,"create_time": "2022-01-04T15:08:33.418288+08:00","last_update_time":
            "2022-01-25T16:17:26.284761+08:00"},}]}'
          schema:
            type: string
      summary: get dbs by id
      tags:
      - user
  /api/v1/metadata/user/delete/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: delete user by id
      tags:
      - user
  /api/v1/metadata/user/email/:email:
    get:
      consumes:
      - application/json
      parameters:
      - description: email
        in: path
        name: email
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by email
      tags:
      - user
  /api/v1/metadata/user/employee-id/:employee_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: employee id
        in: path
        name: employee_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by employee id
      tags:
      - user
  /api/v1/metadata/user/get/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by id
      tags:
      - user
  /api/v1/metadata/user/login-name/:login_name:
    get:
      consumes:
      - application/json
      parameters:
      - description: login name
        in: path
        name: login_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by loginName
      tags:
      - user
  /api/v1/metadata/user/middleware-cluster/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"middleware_clusters": [{"id": 1,"cluster_name": "middleware-cluster-1","env_id":
            1,"del_flag": 0,"create_time": "2021-11-09T18:06:57.917596+08:00","last_update_time":
            "2021-11-18T15:39:52.927116+08:00"}]}'
          schema:
            type: string
      summary: get middleware clusters by id
      tags:
      - user
  /api/v1/metadata/user/mobile/:mobile:
    get:
      consumes:
      - application/json
      parameters:
      - description: mobile
        in: path
        name: mobile
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by mobile
      tags:
      - user
  /api/v1/metadata/user/mysql-cluster/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"mysql_clusters": [{"id": 1,"cluster_name": "mysql-cluster-pmm2","middleware_cluster_id":
            0,"env_id": 1"monitor_system_id": 1,"del_flag": 0,"last_update_time":
            "2021-12-21T09:16:10.750725+08:00","create_time": "2021-09-02T09:02:22.346672+08:00",},]}'
          schema:
            type: string
      summary: get mysql clusters by id
      tags:
      - user
  /api/v1/metadata/user/telephone/:telephone:
    get:
      consumes:
      - application/json
      parameters:
      - description: telephone
        in: path
        name: telephone
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by telephone
      tags:
      - user
  /api/v1/metadata/user/update/:id:
    post:
      consumes:
      - application/json
      parameters:
      - description: user id
        in: path
        name: id
        required: true
        type: integer
      - description: user name
        in: body
        name: user_name
        required: true
        schema:
          type: string
      - description: department name
        in: body
        name: department_name
        required: true
        schema:
          type: string
      - description: employee id
        in: body
        name: employee_id
        required: true
        schema:
          type: string
      - description: user telephone
        in: body
        name: telephone
        required: true
        schema:
          type: string
      - description: user role
        in: body
        name: role
        required: true
        schema:
          type: integer
      - description: account name
        in: body
        name: account_name
        required: true
        schema:
          type: string
      - description: email
        in: body
        name: email
        required: true
        schema:
          type: string
      - description: mobile
        in: body
        name: mobile
        required: true
        schema:
          type: string
      - description: delete flag
        in: body
        name: del_flag
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: update user by id
      tags:
      - user
  /api/v1/metadata/user/user-name/:user_name:
    get:
      consumes:
      - application/json
      parameters:
      - description: user name
        in: path
        name: user_name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get user by name
      tags:
      - user
  /api/v1/query/:sql_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: sql id
        in: path
        name: sql_id
        required: true
        type: integer
      - description: mysql server id
        in: body
        name: mysql_server_id
        required: true
        schema:
          type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: limit
        in: body
        name: limit
        required: true
        schema:
          type: integer
      - description: offset
        in: body
        name: offset
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"queries":[{"sql_id":"F9A57DD5A41825CA","fingerprint":"select
            sleep(?)","example":"select sleep(3)","db_name":"","exec_count":1,"total_exec_time":3,"avg_exec_time":3,"rows_examined_max":0}]}'
          schema:
            type: string
      summary: get slow query by query id
      tags:
      - query
  /api/v1/query/cluster/:mysql_cluster_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql cluster id
        in: path
        name: mysql_cluster_id
        required: true
        type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: limit
        in: body
        name: limit
        required: true
        schema:
          type: integer
      - description: offset
        in: body
        name: offset
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"queries":[{"sql_id":"F9A57DD5A41825CA","fingerprint":"select
            sleep(?)","example":"select sleep(3)","db_name":"","exec_count":1,"total_exec_time":3,"avg_exec_time":3,"rows_examined_max":0}]}'
          schema:
            type: string
      summary: get slow queries by mysql server id
      tags:
      - query
  /api/v1/query/db/:db_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: path
        name: db_id
        required: true
        type: integer
      - description: mysql server id
        in: body
        name: mysql_server_id
        required: true
        schema:
          type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: limit
        in: body
        name: limit
        required: true
        schema:
          type: integer
      - description: offset
        in: body
        name: offset
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"queries":[{"sql_id":"F9A57DD5A41825CA","fingerprint":"select
            sleep(?)","example":"select sleep(3)","db_name":"","exec_count":1,"total_exec_time":3,"avg_exec_time":3,"rows_examined_max":0}]}'
          schema:
            type: string
      summary: get slow queries by db id
      tags:
      - query
  /api/v1/query/host-info:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql server host ip
        in: body
        name: host_ip
        required: true
        schema:
          type: string
      - description: mysql server port number
        in: body
        name: port_num
        required: true
        schema:
          type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: limit
        in: body
        name: limit
        required: true
        schema:
          type: integer
      - description: offset
        in: body
        name: offset
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"queries":[{"sql_id":"F9A57DD5A41825CA","fingerprint":"select
            sleep(?)","example":"select sleep(3)","db_name":"","exec_count":1,"total_exec_time":3,"avg_exec_time":3,"rows_examined_max":0}]}'
          schema:
            type: string
      summary: get slow queries by mysql server host ip and port number
      tags:
      - query
  /api/v1/query/server/:mysql_server_id:
    get:
      consumes:
      - application/json
      parameters:
      - description: mysql server id
        in: path
        name: mysql_server_id
        required: true
        type: integer
      - description: start time
        in: body
        name: start_time
        required: true
        schema:
          type: string
      - description: end time
        in: body
        name: end_time
        required: true
        schema:
          type: string
      - description: limit
        in: body
        name: limit
        required: true
        schema:
          type: integer
      - description: offset
        in: body
        name: offset
        required: true
        schema:
          type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"queries":[{"sql_id":"F9A57DD5A41825CA","fingerprint":"select
            sleep(?)","example":"select sleep(3)","db_name":"","exec_count":1,"total_exec_time":3,"avg_exec_time":3,"rows_examined_max":0}]}'
          schema:
            type: string
      summary: get slow queries by mysql server id
      tags:
      - query
  /api/v1/sqladvisor/advise:
    post:
      consumes:
      - application/json
      parameters:
      - description: db id
        in: body
        name: db_id
        required: true
        schema:
          type: integer
      - description: sql text
        in: body
        name: sql_text
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '[ {  "ID": "B95017DB61875675",  "Fingerprint": "select * from
            t_meta_db_info where create_time<?",  "Score": 85,  "Sample": "select
            * from t_meta_db_info where create_time<''2021-01-01''",  "Explain": null,  "HeuristicRules":
            [    {      "Item": "COL.001",      "Severity": "L1",      "Summary":
            "不建议使用 SELECT * 类型查询",      "Content": "当表结构变更时，使用 * 通配符选择所有列将导致查询的含义和行为会发生更改，可能导致查询返回更多的数据。",      "Case":
            "select * from tbl where id=1",      "Position": 0    }  ],  "IndexRules":
            [    {      "Item": "IDX.001",      "Severity": "L2",      "Summary":
            "为das库的t_meta_db_info表添加索引",      "Content": "为列create_time添加索引; 由于未开启数据采样，各列在索引中的顺序需要自行调整。",      "Case":
            "ALTER TABLE `das`.`t_meta_db_info` add index `idx_create_time` (`create_time`)
            ; ",      "Position": 0    }  ],  "Tables": [    "`soar`.`t_meta_db_info`"  ]}
            ]'
          schema:
            type: string
      summary: get advice
      tags:
      - sqladvisor
  /api/v1/sqladvisor/fingerprint:
    get:
      consumes:
      - application/json
      parameters:
      - description: sql text
        in: body
        name: sql_text
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"fingerprint":"select * from a","sql_text":"select * from
            a;"}'
          schema:
            type: string
      summary: get sql fingerprint
      tags:
      - sqladvisor
  /api/v1/sqladvisor/sql-id:
    get:
      consumes:
      - application/json
      parameters:
      - description: sql text
        in: body
        name: sql_text
        required: true
        schema:
          type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{"sql_id":"EE56B94E867DC9D5","sql_text":"select * from a;"}'
          schema:
            type: string
      summary: get sql id
      tags:
      - sqladvisor
  /api/vi/metadata/app/db/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"dbs": [{"id": 1,"db_name": "db2","cluster_id": 3,"cluster_type":
            1,"env_id": 1,"del_flag": 0,"create_time": "2022-01-04T15:08:33.418288+08:00","last_update_time":
            "2022-01-25T16:17:26.284761+08:00"},}]}'
          schema:
            type: string
      summary: get dbs
      tags:
      - application
  /api/vi/metadata/app/user/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: app id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: '{"users": [{"id": 18,"employee_id": "21213434","account_name":
            "kf-Tom","mobile": "18088888888","role": 2,"user_name": "Tom","department_name":
            "kf","email": "test@test.com.cn","telephone": "02188888888","del_flag":
            0,"create_time": "2022-03-07T15:56:32.277857+08:00","last_update_time":
            "2022-03-07T15:56:32.277857+08:00"}]}'
          schema:
            type: string
      summary: get users
      tags:
      - application
  /api/vi/metadata/middleware-cluster/users/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: users":[{"id":1,"email":"allinemailtest@163.com","role":3,"del_flag":0,"last_update_time":"2021-11-22T13:46:20.430926+08:00","create_time":"2021-10-25T09:21:50.364327+08:00","user_name":"zhangsan","department_name":"arch","employee_id":"100001","account_name":"zs001","telephone":"01012345678","mobile":"13012345678"}]}
          schema:
            type: string
      summary: get middleware servers by cluster id
      tags:
      - middleware cluster
  /api/vi/metadata/middleware-server/:id:
    get:
      consumes:
      - application/json
      parameters:
      - description: middleware cluster id
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: middleware_servers":[{"id":1,"cluster_id":1,"server_name":"update_middeware_server","middleware_role":1,"port_num":33061,"del_flag":0,"create_time":"2021-11-17T14:47:10.521279+08:00","last_update_time":"2022-03-02T10:18:52.564191+08:00","host_ip":"192.168.10.219"}]}
          schema:
            type: string
      summary: get middleware servers by cluster id
      tags:
      - middleware cluster
swagger: "2.0"
